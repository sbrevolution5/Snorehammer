@using Snorehammer.Web.FrontendModels
@using Snorehammer.Web.FrontendModels.Profiles
@using System.Text
@using Snorehammer.Web.Services
<RadzenFieldset AllowCollapse="true">
    <HeaderTemplate>
        <b>@attack.Name</b>
    </HeaderTemplate>
    <ChildContent>
        <EditForm Model="@attack">
            <RadzenLabel>Ranged</RadzenLabel>
            <RadzenSwitch @bind-Value=@attack.Melee />
            <RadzenLabel>Melee</RadzenLabel>
            <RadzenRow AlignItems="AlignItems.End" Wrap="FlexWrap.Wrap" Gap="1rem">
                <RadzenColumn Size="12" SizeMD="6" SizeLG="3">
                    <RadzenStack>
                        <RadzenFormField Text="Name" Variant="Variant.Flat">
                            <RadzenTextBox @bind-Value="attack.Name" />
                        </RadzenFormField>
                    </RadzenStack>
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="2" SizeLG="2">
                    <RadzenStack>
                        <RadzenFormField Text="Weapons in unit" Variant="Variant.Flat">
                            <RadzenNumeric @bind-Value="attack.WeaponsInUnit" />
                        </RadzenFormField>
                    </RadzenStack>
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="2" SizeLG="2">
                    <RadzenStack>
                        <RadzenRow JustifyContent="JustifyContent.Center">
                            <RadzenCheckBox @bind-Value=@attack.IsVariableAttacks Name="Variable" />
                            <RadzenLabel Text="Roll for # of attacks" Component="Variable" class="rz-ms-2" />
                        </RadzenRow>
                        @if (attack.IsVariableAttacks)
                        {
                            <RadzenFormField Text="Attacks (X * [d]y + z)" Variant="Variant.Flat">
                                <RadzenNumeric @bind-Value="attack.VariableAttackDiceNumber" />
                                <RadzenNumeric @bind-Value="attack.VariableAttackDiceSides" />
                                <RadzenNumeric @bind-Value="attack.VariableAttackDiceConstant" />
                            </RadzenFormField>
                        }
                        else
                        {
                            <RadzenFormField Text="Number of attacks" Variant="Variant.Flat">
                                <RadzenNumeric @bind-Value="attack.Attacks" />
                            </RadzenFormField>
                        }
                    </RadzenStack>
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="2" SizeLG="2">
                    <RadzenStack>
                        <RadzenFormField Text="To hit" Variant="Variant.Flat">
                            <RadzenNumeric @bind-Value="attack.Skill" />
                        </RadzenFormField>
                    </RadzenStack>
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="2" SizeLG="2">
                    <RadzenStack>
                        <RadzenFormField Text="Strength" Variant="Variant.Flat">
                            <RadzenNumeric @bind-Value="attack.Strength" />
                        </RadzenFormField>
                    </RadzenStack>
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="2" SizeLG="2">
                    <RadzenStack>
                        <RadzenRow JustifyContent="JustifyContent.Center">
                            <RadzenCheckBox @bind-Value=@attack.IsVariableDamage Name="Variable" />
                            <RadzenLabel Text="Rolls damage" Component="Variable" class="rz-ms-2" />
                        </RadzenRow>
                        @if (attack.IsVariableDamage)
                        {
                            <RadzenFormField Text="Damage (X * [d]y + z)" Variant="Variant.Flat">
                                <RadzenNumeric @bind-Value="attack.VariableDamageDiceNumber" />
                                <RadzenNumeric @bind-Value="attack.VariableDamageDiceSides" />
                                <RadzenNumeric @bind-Value="attack.VariableDamageDiceConstant" />
                            </RadzenFormField>
                        }
                        else
                        {
                            <RadzenFormField Text="Damage" Variant="Variant.Flat">
                                <RadzenNumeric @bind-Value="attack.Damage" />
                            </RadzenFormField>
                        }
                    </RadzenStack>
                </RadzenColumn>
            </RadzenRow>

            <RadzenPanel AllowCollapse="true" class="rz-my-10 rz-mx-auto">
                <HeaderTemplate>
                    <RadzenText TextStyle="TextStyle.H6" class="rz-display-flex rz-align-items-center rz-m-0">
                        <RadzenIcon Icon="account_box" class="rz-me-1" /><b>Abilities</b>
                    </RadzenText>
                </HeaderTemplate>
                <ChildContent>
                    <RadzenRow AlignItems="AlignItems.Start" Wrap="FlexWrap.Wrap" Gap="1rem" class="rz-p-sm-12">
                        <RadzenColumn Size="12" SizeMD="6" SizeLG="3">

                            <RadzenFieldset AllowCollapse="true" Collapsed="true">
                                <HeaderTemplate><b>Hit Roll Modifiers</b></HeaderTemplate>
                                <ChildContent>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox @bind-Value=@attack.RerollHit Name="RerollHit" />
                                        <RadzenLabel Text="Reroll Hit" Component="RerollHit" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox @bind-Value=@attack.Plus1Hit Name="Plus1Hit" />
                                        <RadzenLabel Text="Plus 1 to Hit" Component="Plus1Hit" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox @bind-Value=@attack.Minus1Hit Name="Minus1Hit" />
                                        <RadzenLabel Text="Minus 1 to Hit" Component="Minus1Hit" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox Disabled=attack.Melee @bind-Value=@attack.Torrent Name="Torrent" />
                                        <RadzenLabel Text="Torrent" Component="Torrent" class=@($"rz-ms-2 {MeleeLabel(false)}") />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox @bind-Value=@attack.Reroll1Hit Name="Reroll1Hit" />
                                        <RadzenLabel Text="Reroll 1s for Hit" Component="Reroll1Hit" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox Disabled=attack.Melee @bind-Value=@attack.BigGuns Name="BigGuns" />
                                        <RadzenLabel Text="Big Guns Never Tire" Component="BigGuns" class=@($"rz-ms-2 {MeleeLabel(false)}") />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox @bind-Value=@attack.Sustained Name="Sustained" />
                                        <RadzenLabel Text="Sustained Hits" Component="Sustained" class="rz-ms-2" />
                                        <RadzenFormField Text="" Style="width: 100%;">
                                            <RadzenNumeric @bind-Value="@attack.SustainAmount" Disabled=!attack.Sustained />
                                        </RadzenFormField>
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox Disabled=attack.Melee @bind-Value=@attack.Blast Name="Blast" />
                                        <RadzenLabel Text="Blast" Component="Blast" class=@($"rz-ms-2 {MeleeLabel(false)}") />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox @bind-Value=@attack.Lethal Name="Lethal" />
                                        <RadzenLabel Text="Lethal Hits" Component="Lethal" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenRow>
                                            <RadzenCheckBox @bind-Value=@attack.RapidFire Name="Rapid Fire" />
                                            <RadzenLabel Text="Rapid Fire" Component="Rapid Fire" class="rz-ms-2" />
                                        </RadzenRow>
                                        <RadzenFormField Style="width: 100%">
                                            <RadzenNumeric @bind-Value="attack.RapidFireBonus" Disabled=!attack.RapidFire />
                                        </RadzenFormField>
                                    </RadzenColumn>

                                </ChildContent>
                                <SummaryTemplate>
                                    @HitSummary()
                                </SummaryTemplate>
                            </RadzenFieldset>
                        </RadzenColumn>
                        <RadzenColumn Size="12" SizeMD="6" SizeLG="3">
                            <RadzenFieldset AllowCollapse="true" Collapsed="true">
                                <HeaderTemplate>
                                    <b>Wound Roll</b>
                                </HeaderTemplate>
                                <ChildContent>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox @bind-Value=@attack.RerollWound Name="RerollWound" />
                                        <RadzenLabel Text="Twin-linked/Reroll Wounds" Component="RerollWound" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox @bind-Value=@attack.Plus1Wound Name="Plus1Wound" />
                                        <RadzenLabel Text="Plus 1 to Wound roll" Component="Plus1Wound" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox Disabled=!attack.Melee @bind-Value=@attack.Lance Name="Lance" />
                                        <RadzenLabel Text="Lance (assumes unit charged)" Component="Lance" class=@($"rz-ms-2 {MeleeLabel(true)}") />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox @bind-Value=@attack.Devastating Name="Devastating" />
                                        <RadzenLabel Text="Devastating Wounds" Component="Devastating" class="rz-ms-2" />
                                    </RadzenColumn>

                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox @bind-Value=@attack.Reroll1Wound Name="Reroll1Wound" />
                                        <RadzenLabel Text="Reroll 1s for Wounds" Component="Reroll1Wound" class="rz-ms-2" />
                                    </RadzenColumn>
                                </ChildContent>
                                <SummaryTemplate>
                                    @WoundSummary()
                                </SummaryTemplate>
                            </RadzenFieldset>
                        </RadzenColumn>
                        <RadzenColumn Size="12" SizeMD="6" SizeLG="3">
                            <RadzenFieldset AllowCollapse="true" Collapsed="true">
                                <HeaderTemplate>
                                    <b>Damage</b>
                                </HeaderTemplate>
                                <ChildContent>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox @bind-Value=@attack.RerollDamage Name="RerollDamage" />
                                        <RadzenLabel Text="Reroll Damage" Component="RerollDamage" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox @bind-Value=@attack.Reroll1Damage Name="Reroll1Damage" />
                                        <RadzenLabel Text="Reroll 1s for Damage" Component="Reroll1Damage" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenCheckBox Disabled=attack.Melee @bind-Value=@attack.Melta Name="Melta" />
                                        <RadzenLabel Text="Melta " Component="Melta" class=@($"rz-ms-2 {MeleeLabel(false)}") />
                                        <RadzenFormField Text="Assumes attacker is within melta range" Style="width: 100%;">
                                            <RadzenNumeric @bind-Value="@attack.MeltaDamage" Disabled=!attack.Melta />
                                        </RadzenFormField>
                                    </RadzenColumn>
                                </ChildContent>
                                <SummaryTemplate>
                                    @DamageSummary()
                                </SummaryTemplate>
                            </RadzenFieldset>
                        </RadzenColumn>
                        <RadzenColumn Size="12" SizeMD="6" SizeLG="3">
                            <RadzenFieldset AllowCollapse="true" Collapsed="true">
                                <HeaderTemplate>
                                    <b>Anti-X</b>
                                </HeaderTemplate>
                                <ChildContent>

                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenFormField Visible=attack.AntiInfantry Style="width: 100%;">
                                            <RadzenNumeric @bind-Value="@attack.AntiInfantryValue" />
                                        </RadzenFormField>
                                        <RadzenCheckBox @bind-Value=@attack.AntiInfantry Name="AntiInfantry" />
                                        <RadzenLabel Text="Anti-Infantry" Component="AntiInfantry" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenFormField Visible=attack.AntiMonster Style="width: 100%;">
                                            <RadzenNumeric @bind-Value="@attack.AntiMonsterValue" />
                                        </RadzenFormField>
                                        <RadzenCheckBox @bind-Value=@attack.AntiMonster Name="AntiMonster" />
                                        <RadzenLabel Text="Anti-Monster" Component="AntiMonster" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenFormField Visible=attack.AntiVehicle Style="width: 100%;">
                                            <RadzenNumeric @bind-Value="@attack.AntiVehicleValue" />
                                        </RadzenFormField>
                                        <RadzenCheckBox @bind-Value=@attack.AntiVehicle Name="AntiVehicle" />
                                        <RadzenLabel Text="Anti-Vehicle" Component="AntiVehicle" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenFormField Visible=attack.AntiMounted Style="width: 100%;">
                                            <RadzenNumeric @bind-Value="@attack.AntiMountedValue" />
                                        </RadzenFormField>
                                        <RadzenCheckBox @bind-Value=@attack.AntiMounted Name="AntiMounted" />
                                        <RadzenLabel Text="Anti-Mounted" Component="AntiMounted" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenFormField Visible=attack.AntiSwarm Style="width: 100%;">
                                            <RadzenNumeric @bind-Value="@attack.AntiSwarmValue" />
                                        </RadzenFormField>
                                        <RadzenCheckBox @bind-Value=@attack.AntiSwarm Name="AntiSwarm" />
                                        <RadzenLabel Text="Anti-Swarm" Component="AntiSwarm" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenFormField Visible=attack.AntiBeast Style="width: 100%;">
                                            <RadzenNumeric @bind-Value="@attack.AntiBeastValue" />
                                        </RadzenFormField>
                                        <RadzenCheckBox @bind-Value=@attack.AntiBeast Name="AntiBeast" />
                                        <RadzenLabel Text="Anti-Beast" Component="AntiBeast" class="rz-ms-2" />
                                    </RadzenColumn>
                                    <RadzenColumn Size="6" SizeMD="3" SizeLG="2" class="rz-p-3 rz-text-align-center">
                                        <RadzenFormField Visible=attack.AntiPsyker Style="width: 100%;">
                                            <RadzenNumeric @bind-Value="@attack.AntiPsykerValue" />
                                        </RadzenFormField>
                                        <RadzenCheckBox @bind-Value=@attack.AntiPsyker Name="AntiPsyker" />
                                        <RadzenLabel Text="Anti-Psyker" Component="AntiPsyker" class="rz-ms-2" />
                                    </RadzenColumn>
                                </ChildContent>
                                <SummaryTemplate>
                                    @AntiSummary()
                                </SummaryTemplate>
                            </RadzenFieldset>
                        </RadzenColumn>
                    </RadzenRow>
                </ChildContent>
                <SummaryTemplate>
                    @AbilitySummary()
                </SummaryTemplate>
            </RadzenPanel>
        </EditForm>
    </ChildContent>
    <SummaryTemplate>
        <RadzenText>
            Attacks | Strength | AP | Damage
        </RadzenText>
        <RadzenText>

            @AttackSummary()
        </RadzenText>
        <RadzenText>
            @AbilitySummary()
        </RadzenText>
    </SummaryTemplate>
</RadzenFieldset>
@code {
    [Parameter]
    public AttackProfile attack { get; set; }
    [Parameter]
    public EventCallback<AttackProfile> AttackChanged { get; set; }
    public SummaryService summaryService { get; set; } = new SummaryService();
    public string AttackSummary()
    {
        return summaryService.AttackSummary(attack);
    }
    public string AbilitySummary()
    {
        return summaryService.AbilitySummary(attack);
    }
    public string HitSummary()
    {
        return summaryService.HitSummary(attack);
    }
    public string AntiSummary()
    {
        return summaryService.AntiSummary(attack);
    }
    public string WoundSummary()
    {
        return summaryService.WoundSummary(attack);
    }
    public string DamageSummary()
    {
        return summaryService.DamageSummary(attack);
    }
    public string MeleeLabel(bool enabledMelee)
    {
        if (enabledMelee)
        {
            if (attack.Melee)
            {
                return "rz-text-disabled-color";
            }
            else
            {
                return "";
            }
        }
        else
        {
            if (!attack.Melee)
            {
                return "rz-text-disabled-color";
            }
            else
            {
                return "";
            }
        }
    }
}
